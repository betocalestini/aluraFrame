{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","NegociacoesView","MensagemView","NegociacaoService","DateHelper","Bind","Negociacao","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","_mensagem","_ordemAtual","_service","_init","lista","then","negociacoes","forEach","negociacao","adiciona","catch","erro","texto","setInterval","importaNegociacoes","event","preventDefault","_criaNegociacao","cadastra","mensagem","_limpaFormulario","console","log","importa","apaga","esvazia","_mensage","textoParaData","value","parseInt","parseFloat","focus","coluna","inverteOrdem","ordena","p","s","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { ListaNegociacoes } from '../models/ListaNegociacoes';\nimport { Mensagem } from '../models/Mensagem';\nimport { NegociacoesView } from '../views/NegociacoesView';\nimport { MensagemView } from '../views/MensagemView';\nimport { NegociacaoService } from '../services/NegociacaoService';\nimport { DateHelper } from '../helpers/DateHelper';\nimport { Bind } from '../helpers/Bind';\nimport { Negociacao } from '../models/Negociacao';\n\nclass NegociacaoController {\n   constructor() {\n      let $ = document.querySelector.bind(document);\n\n      this._inputData = $('#data');\n      this._inputQuantidade = $('#quantidade');\n      this._inputValor = $('#valor');\n\n      this._listaNegociacoes = new Bind(\n         new ListaNegociacoes(),\n         new NegociacoesView($('#negociacoesView')),\n         'adiciona',\n         'esvazia',\n         'ordena',\n         'inverteOrdem'\n      );\n\n      this._mensagem = new Bind(new Mensagem(), new MensagemView($('#mensagemView')), 'texto');\n\n      this._ordemAtual = '';\n\n      this._service = new NegociacaoService();\n\n      this._init();\n   }\n\n   _init() {\n      this._service\n         .lista()\n         .then((negociacoes) =>\n            negociacoes.forEach((negociacao) => this._listaNegociacoes.adiciona(negociacao))\n         )\n         .catch((erro) => (this._mensagem.texto = erro));\n\n      setInterval(() => {\n         this.importaNegociacoes();\n      }, 3000);\n   }\n\n   adiciona(event) {\n      event.preventDefault();\n\n      let negociacao = this._criaNegociacao();\n\n      this._service\n         .cadastra(negociacao)\n         .then((mensagem) => {\n            this._listaNegociacoes.adiciona(negociacao);\n            this._mensagem.texto = mensagem;\n            this._limpaFormulario();\n         })\n         .catch((erro) => (this._mensagem.texto = erro));\n   }\n\n   importaNegociacoes() {\n      console.log(this._listaNegociacoes);\n      this._service\n         .importa(this._listaNegociacoes.negociacoes)\n         .then((negociacoes) =>\n            negociacoes.forEach((negociacao) => {\n               this._listaNegociacoes.adiciona(negociacao);\n               this._mensagem.texto = 'Negociações do período importadas';\n            })\n         )\n         .catch((erro) => (this._mensagem.texto = erro));\n   }\n\n   apaga() {\n      this._service\n         .apaga()\n         .then((mensagem) => {\n            this._mensagem.texto = mensagem;\n            this._listaNegociacoes.esvazia();\n         })\n         .catch((erro) => (this._mensage.texto = erro));\n   }\n\n   _criaNegociacao() {\n      return new Negociacao(\n         DateHelper.textoParaData(this._inputData.value),\n         parseInt(this._inputQuantidade.value),\n         parseFloat(this._inputValor.value)\n      );\n   }\n\n   _limpaFormulario() {\n      this._inputData.value = '';\n      this._inputQuantidade.value = 1;\n      this._inputValor.value = 0.0;\n      this._inputData.focus();\n   }\n\n   ordena(coluna) {\n      console.log(coluna);\n      if (this._ordemAtual == coluna) {\n         this._listaNegociacoes.inverteOrdem();\n      } else {\n         console.log(this._listaNegociacoes);\n         this._listaNegociacoes.ordena((p, s) => p[coluna] - s[coluna]);\n      }\n      this._ordemAtual = coluna;\n   }\n}\n\nlet negociacaoController = new NegociacaoController();\n\nexport function currentInstance() {\n   return negociacaoController;\n}\n"]}